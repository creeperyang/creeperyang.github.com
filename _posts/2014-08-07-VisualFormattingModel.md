---
layout: article
comments: true
title: CSS Visual Formatting Model
category: tech
tags: [CSS, Box model]
description: <p>wait...</p>
---

声明：

本文参考<http://topic.csdn.net/u/20100719/17/ff203b89-135e-46cf-8fce-705f16e37beb.html?006156676166584196>

定义以下术语：

1. visual formatting model： 可视化格式模型，下文中简称模型。
2. media： 媒介，CSS中的重要概念，即展示页面的介质，最常见的是screen（显示器），其它还有纸媒介等待。
3. user agent： 用户代理，即浏览器。
4. dom tree： 文档树，下文中简称树。
5. box model： 盒模型。
6. positioning scheme： 定位体系。
7. containing blocks： 包含块，元素生成box，该box就是子元素的包含块。

##Introduction to the visual formatting model

本章及下章描述了可视化格式模型：浏览器怎么为可视媒介处理文档树？

在模型中，根据盒模型，树中每个元素生成0个或多个盒子。这些盒子的布局受以下因素影响：

1. box尺寸和类型。
   类型特指`display`特性决定的元素类型，如`div`是块级元素，`span`是行内元素。

2. 定位体系。

    元素在布局时，根据3种定位体系定位。分别是，常规流、浮动和绝对定位。

3. 文档树中元素之间的关系。

    比如，一个块元素包含两个互为兄弟节点的浮动元素，后面那个浮动元素的布局，会受前面元素以及它包含块的影响。

4. 外部信息。
    
    比如，可视窗口的大小，我们有时候会做页面自适应窗口大小的功能，就是因为，窗口大小对布局有影响。再如，图片的固有尺寸，会影响行内替换元素的尺寸，进而影响整个布局。

模型没有定义格式的所有细节，所以在没有定义的方面（比如letter-spacing）各浏览器可能表现有差异。

###The viewport

视口，显示屏上的窗口或其它显示区域。视口尺寸大小改变时，浏览器会改变文档的布局。比如，有些值是依赖于视口大小的，`div` width的auto值，等等。

当视口的尺寸小于文档渲染的画布（也就是页面）的大小时，浏览器应该提供滚动机制。每个画布最多有一个视口。但是，浏览器可以同时渲染多个画布。也就是说，浏览器可以打开多个页面，但是每个页面最多只有一个视口。

###Containing blocks

在CSS2.1中，很多box的定位和尺寸的计算，都取决于一个矩形的边界，这个矩形，就被称作是包含块(containing block)。一般来说，(元素)生成的box会扮演它子孙元素包含块的角色；我们称之为：一个元素的box为它的子孙节点创建了包含块。

包含块是一个相对的概念。“一个box的包含块”，指的是“该box所存在的那个包含块”，并不是它建造的包含块。

每个box相对于它的包含块都有一个位置，但是它不会被包含块限制；它可以溢出(包含块)。

##Containing blocks详细

上面说道，一个元素box的定位和尺寸，有时候会跟某一矩形框有关，这个矩形框，就被称作元素的包含块。而元素会为它的子孙元素创建包含块，那么，是不是说，元素的包含块就是它的父元素呢？答案是否定的，这是一个误区。也正因为如此，才会专门来说明它。

**一个元素包含块的确定，跟元素自身和它的祖先元素的样式等有关系。**

###根元素的包含块

根元素，就是处于文档树最顶端的元素，它没有父节点。

根元素存在的包含块，被叫做初始包含块 (initial containing block)。具体，跟用户端有关。

*  在(X)HTML中，根元素是html元素（尽管有的浏览器会不正确地使用body元素）。
*  初始包含块的direction属性与根元素相同。

###"static"和"relative"定位的元素

对于其它元素：如果该元素的定位（position）为 "relative" （相对定位）或者 "static"（静态定位），它的包含块由它最近的块级、单元格（table cell）或者行内块（inline-block）祖先元素的box创建。

元素如果未声明"position"特性 ，那么就会采用"position"的默认值 ”static”。所以，一般元素都是静态定位的。

###"position:fixed" 定位的元素

如果元素是固定定位 ("position:fixed") 元素，那么它的包含块是当前可视窗口。

###"position: absolute" 定位的元素

如果元素是绝对定位（"position: absolute"）元素，包含块由离它最近的position属性为 "absolute"、"relative" 或者 "fixed" 的祖先元素创建。

...

...

...

